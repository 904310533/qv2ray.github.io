<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced Route Settings | Qv2ray</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="icon" href="/logo.svg">
    <meta name="description" content="Make v2ray real cross-platform">
    <link rel="preload" href="/assets/css/0.styles.f2d91595.css" as="style"><link rel="preload" href="/assets/js/app.43ebf8b0.js" as="script"><link rel="preload" href="/assets/js/3.b5cf6559.js" as="script"><link rel="preload" href="/assets/js/25.44d256fe.js" as="script"><link rel="preload" href="/assets/js/8.960df767.js" as="script"><link rel="prefetch" href="/assets/js/10.73f77b10.js"><link rel="prefetch" href="/assets/js/11.5d07c23e.js"><link rel="prefetch" href="/assets/js/12.91ec3ef4.js"><link rel="prefetch" href="/assets/js/13.a2ea84fb.js"><link rel="prefetch" href="/assets/js/14.5c35d335.js"><link rel="prefetch" href="/assets/js/15.d49a54de.js"><link rel="prefetch" href="/assets/js/16.c70a3ccd.js"><link rel="prefetch" href="/assets/js/17.47ad875d.js"><link rel="prefetch" href="/assets/js/18.e36eca96.js"><link rel="prefetch" href="/assets/js/19.54145ab3.js"><link rel="prefetch" href="/assets/js/20.d9b2494f.js"><link rel="prefetch" href="/assets/js/21.71cfc993.js"><link rel="prefetch" href="/assets/js/22.91caeae5.js"><link rel="prefetch" href="/assets/js/23.c28fe121.js"><link rel="prefetch" href="/assets/js/24.5709eef7.js"><link rel="prefetch" href="/assets/js/26.b0556172.js"><link rel="prefetch" href="/assets/js/27.1ae7ba2a.js"><link rel="prefetch" href="/assets/js/28.514dbf87.js"><link rel="prefetch" href="/assets/js/29.ba8c230f.js"><link rel="prefetch" href="/assets/js/30.7887c337.js"><link rel="prefetch" href="/assets/js/31.d3fa2457.js"><link rel="prefetch" href="/assets/js/32.956ea390.js"><link rel="prefetch" href="/assets/js/33.5a4b9316.js"><link rel="prefetch" href="/assets/js/34.e3a0b07a.js"><link rel="prefetch" href="/assets/js/35.bb21957e.js"><link rel="prefetch" href="/assets/js/36.8811c106.js"><link rel="prefetch" href="/assets/js/37.31a42071.js"><link rel="prefetch" href="/assets/js/38.102b1fb2.js"><link rel="prefetch" href="/assets/js/39.c4e4347f.js"><link rel="prefetch" href="/assets/js/4.37ff031b.js"><link rel="prefetch" href="/assets/js/40.7f18adef.js"><link rel="prefetch" href="/assets/js/41.bd38f0c4.js"><link rel="prefetch" href="/assets/js/42.2bd2217a.js"><link rel="prefetch" href="/assets/js/43.1af64f58.js"><link rel="prefetch" href="/assets/js/44.60b7e0c4.js"><link rel="prefetch" href="/assets/js/45.88763dcc.js"><link rel="prefetch" href="/assets/js/46.b6304325.js"><link rel="prefetch" href="/assets/js/47.466adb38.js"><link rel="prefetch" href="/assets/js/48.2380464d.js"><link rel="prefetch" href="/assets/js/5.d4abafcd.js"><link rel="prefetch" href="/assets/js/6.3072bd07.js"><link rel="prefetch" href="/assets/js/7.8eab7b3e.js"><link rel="prefetch" href="/assets/js/9.65d4f5b5.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.33b3cf02.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f2d91595.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/logo.svg" alt="Qv2ray" class="logo"> <span class="site-name can-hide">Qv2ray</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/en/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/en/faq/" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/en/hacking/" class="nav-link">
  Hacking
</a></div><div class="nav-item"><a href="/en/plugins/" class="nav-link">
  Plugin System
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/manual/route.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/manual/route.html" class="nav-link">
  ç®€ä½“ä¸­æ–‡
</a></li></ul></div></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span>Switch theme</span></a></div> <a href="https://github.com/Qv2ray/Qv2ray" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/en/manual/" class="nav-link router-link-active">
  Manual
</a></div><div class="nav-item"><a href="/en/faq/" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/en/hacking/" class="nav-link">
  Hacking
</a></div><div class="nav-item"><a href="/en/plugins/" class="nav-link">
  Plugin System
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/manual/route.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/manual/route.html" class="nav-link">
  ç®€ä½“ä¸­æ–‡
</a></li></ul></div></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span>Switch theme</span></a></div> <a href="https://github.com/Qv2ray/Qv2ray" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/en/manual/" aria-current="page" class="sidebar-link">Manual</a></li><li><a href="/en/manual/general.html" class="sidebar-link">General Settings</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/manual/general.html#appearance" class="sidebar-link">Appearance</a></li><li class="sidebar-sub-header"><a href="/en/manual/general.html#behavior" class="sidebar-link">Behavior</a></li><li class="sidebar-sub-header"><a href="/en/manual/general.html#network-settings" class="sidebar-link">Network Settings</a></li><li class="sidebar-sub-header"><a href="/en/manual/general.html#advanced-behavior" class="sidebar-link">Advanced Behavior</a></li></ul></li><li><a href="/en/manual/route.html" aria-current="page" class="active sidebar-link">Advanced Route Settings</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/manual/route.html#route-plan" class="sidebar-link">Route Plan</a></li><li class="sidebar-sub-header"><a href="/en/manual/route.html#routing-editor" class="sidebar-link">Routing Editor</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-succinct-content content__default"><h1 id="advanced-route-settings"><a href="#advanced-route-settings" class="header-anchor">#</a> Advanced Route Settings</h1> <p>Advanced routing settings and the routing editor are distinctive features of Qv2ray. With their functionality, you can achieve precise control of traffic, such as on-demand proxy, domestic and foreign distribution, etc., and even do Matryoshkas ðŸ¤£~</p> <p>Letâ€™s discuss routing. This concerns the PAC and GFWList.</p> <p>If you don't know what the routing function of V2Ray is, then you can understand it as a new generation PAC implementation with simpler configuration, more efficient use, and better rules.</p> <p>The routing function is far more powerful than PAC, so please don't ask whether Qv2ray supports PAC! The data used by the routing function is more complete than GFWList, so GFWList is no longer needed.</p> <p>#Global routing rules
The global routing rule configuration function is in the Advanced Routing Settings tab of Preferences.</p> <p>#Domain strategy
Contains three types: AsIs, IPIfNonMatch, and IPOnDemand.</p> <p>According to V2Ray's official documents, the meaning of the three domain name strategies are as follows:</p> <p>AsIs: Use only the domain name for routing. Defaults.
IPIfNonMatch: When the domain name does not match any rules, the domain name is resolved into IP (A record or AAAA record) for matching again:
When a domain name has multiple A records, it will try to match all A records until one of them matches a certain rule;
The resolved IP only works during routing, and the original domain name is still used in the forwarded data packets.
IPOnDemand: When any IP-based rules are encountered during matching, the domain name will be immediately resolved to IP for matching.
In short, based on a developerâ€™s statement:</p> <p>AsIs: fast analysis, imprecise diversion;
IPIfNonMatch: parsing is slightly slower, and shunt is accurate
IPOnDemand: Useless.
Author's Note: IPOnDemand should be the slowest but most accurate, but in most cases, IPIfNonMatch is sufficient, so the actual effect of IPOnDemand is not obvious.</p> <p>You can choose the corresponding domain name strategy according to your actual needs. Generally speaking, IPIfNonMatch is the ideal choice in most situations.</p> <h2 id="route-plan"><a href="#route-plan" class="header-anchor">#</a> Route Plan</h2> <p>The routing plan consists of a 3x2 matrix, from top left to bottom right: IP direct connection, IP proxy, IP blocking, domain name direct connection, domain name proxy, domain name blocking, one per line, no comma separation.</p> <p>These 6 rules in Qv2ray are matched according to the priority of domain name blocking -&gt; domain name proxy -&gt; domain name direct connection -&gt; IP blocking -&gt; IP proxy -&gt; IP direct connection. If the match fails, the private address and the mainland China domestic address are directly connected, otherwise the agent will be used.</p> <p>I just want a global agent~~~ ðŸ¤—</p> <p>It's very simple. Just clear these rules, go to the Connection tab of Preferences, and uncheck the Bypass China check box. ðŸ™„</p> <p>According to the official V2Ray documentation:</p> <p>The IP rules are written as follows (in order of common usage):</p> <p>GeoIP: The form is geoip:cn, which must start with geoip: (all lowercase) followed by a two-character country code. For example, geoip:cn represents an IP address in China, and geoip:us represents an IP address in the United States.
Special value: geoip:private, including all private addresses, such as 127.0.0.1 (this rule only supports V2Ray 3.5 and above).
IP: The format is 127.0.0.1.
CIDR: The format is 10.0.0.0/8.
Load IP rules from external files: the form is ext:file:tag, which must start with ext: (all lowercase), followed by the file name (without extension) file and tag, the file must be stored in the V2Ray core resource directory. The file format is the same as geoip.dat, and the specified tag must exist in the file.</p> <p>The domain name rules are written as follows (in order of common use):</p> <p>A list of predefined domain names:</p> <p>Starts with geosite:, and the rest is a name, such as geosite:google or geosite:cn. For the name and domain name list, please refer to the predefined domain name list.</p> <p>Subdomain: Starts with domain:, and the rest is a domain name. This rule takes effect when the domain name is the target domain name or its subdomain name. For example, domain:v2ray.com matches www.v2ray.com and v2ray.com, but not xv2ray.com.</p> <p>Complete match: Starts with full:, and the rest is a domain name. When this domain name completely matches the target domain name, the rule takes effect. For example, full:v2ray.com matches v2ray.com but not www.v2ray.com.</p> <p>Pure string: When this string matches any part of the target domain name, the rule takes effect. For example, sina.com can match sina.com, sina.com.cn and www.sina.com, but not sina.cn.</p> <p>Regular expression: Starts with regexp:, and the rest is a regular expression. When this regular expression matches the target domain name, the rule takes effect. For example, regexp:\.goo.*\.com$ matches www.google.com, fonts.googleapis.com, but not google.com.</p> <p>Rules for loading domain names from external files: the format is ext:file:tag, which must start with ext: (all lowercase), followed by the file name (without extension) file and tag, and the file must be stored in the V2Ray core resource directory. The file format is the same as geosite.dat, and the specified tag must exist in the file.</p> <p>If you want to implement a global proxy, that is, regardless of the destination address, all traffic will go through the proxy, then refer to the other tips above. ðŸ˜…
If you want to achieve precise diversion, that is, all outbound traffic should go through the proxy, then just click the preset plan button in the interface, select the blank plan or the ad blocking plan, and set the domain name strategy to IPIfNonMatch. .ðŸ˜‹</p> <p>Suppose you need more precise diversion rules! ðŸ¤”</p> <p>Then the author recommends the enhanced version of the V2Ray rules file project. The warehouse address is Loyalsoldier/v2ray-rules-dat. ðŸ¤—</p> <p>Suppose you need highly customizable diversion rules! ðŸ¤ª</p> <p>Please refer to the next section Routing Editor. ðŸ˜„</p> <h2 id="routing-editor"><a href="#routing-editor" class="header-anchor">#</a> Routing Editor</h2> <p>In the main interface of Qv2ray, right-click the agent node and select Edit as a complex configuration to open the Route Editor interface.</p> <p>In this interface, you can arbitrarily combine matching conditions such as user, source IP, target IP, domain name, target domain name, protocol, and port to create sufficiently accurate inbound/outbound rules, and you can also adjust the priority of the rules arbitrarily Level, even achieve load balancing.</p> <p>What needs reiterating is that the matching conditions in each routing rule are and / and / &amp;&amp; relationships, that is, if a routing rule contains multiple matching conditions, the actual matching conditions finally obtained are the intersection of these conditions. For example, if a routing rule contains both the port condition 443 and the target domain name condition qv2ray.github.io, then only the target qv2ray.github.io:443 that meets both conditions will match this item rule.</p> <p>If you don't know much about V2Ray's routing rules mechanism, please refer to V2Ray's official documentation.</p> <p>END</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Qv2ray/qv2ray.github.io/edit/source/docs/en/manual/route.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/2/2020, 1:13:05 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      âŸµ
      <a href="/en/manual/general.html" class="prev">
        General Settings
      </a></span> <!----></p></div> </main></div><div class="global-ui"><div style="visibility:hidden;display:none;"></div><!----></div></div>
    <script src="/assets/js/app.43ebf8b0.js" defer></script><script src="/assets/js/3.b5cf6559.js" defer></script><script src="/assets/js/25.44d256fe.js" defer></script><script src="/assets/js/8.960df767.js" defer></script>
  </body>
</html>
